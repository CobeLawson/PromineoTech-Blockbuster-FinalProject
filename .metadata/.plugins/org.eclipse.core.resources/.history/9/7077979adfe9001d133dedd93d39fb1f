DROP TABLE reviews;
DROP TABLE transactions;
DROP TABLE products;
DROP TABLE video_games;
DROP TABLE movies;
DROP TABLE customers;
DROP TABLE administration;

CREATE TABLE administration (
	administrator_pk int unsigned NOT NULL AUTO_INCREMENT,
	administrator_role varchar(25) NOT NULL,
	administrator_name varchar(50) NOT NULL,
	administrator_phone varchar(50) NOT NULL,
	PRIMARY KEY (administrator_pk)
);

CREATE TABLE customers (
	customer_pk int unsigned NOT NULL AUTO_INCREMENT, 
	customer_name varchar(50) NOT NULL,
	customer_age int NOT NULL,
	customer_phone varchar(25) NOT NULL,
	PRIMARY KEY (customer_pk)
);

CREATE TABLE movies (
	movie_pk int unsigned NOT NULL AUTO_INCREMENT, 
	title varchar(50) NOT NULL,
	price float(4,2) NOT NULL,
	media_type enum('LASERDISK', 'VHS', 'DVD', 'BLURAY', 'BLURAY_4K') NOT NULL,
	genre enum('DRAMA', 'COMEDY', 'ANIMATION', 'FAMILY', 'HORROR', 'ACTION', 'ADVENTURE', 'MYSTERY', 'ROMANCE', 'SCIENCE_FICTION', 'FANTASY', 'COMING_OF_AGE', 'DOCUMENTARY') NOT NULL,
	PRIMARY KEY (movie_pk)
);

CREATE TABLE video_games (
	video_game_pk int unsigned NOT NULL AUTO_INCREMENT, 
	title varchar(50) NOT NULL,
	price float(4,2) NOT NULL,
	console enum('COMPUTER', 'XBOX', 'XBOX_360', 'XBOX_ONE', 'XBOX_SERIES_X', 'PLAYSTATION', 'PLAYSTATION_2', 'PLAYSTATION_3', 'PLAYSTATION_4', 'PLAYSTATION_5', 'NINTENDO_GAMEBOY', 'NINTENDO_DS', 'NINTENDO_3DS', 'NINTENDO_GAMECUBE', 'NINTENDO_WII', 'NINTENDO_WII_U', 'NINTENDO_SWITCH') NOT NULL,
	gameplay enum('ROLE_PLAYING_GAME', 'FIRST_PERSON_SHOOTER', 'THIRD_PERSON_SHOOTER', 'PLATFORMER', 'TOP_DOWN', 'DECK_BUILDER', 'STRATEGY', 'MASSIVE_MULTIPLAYER_ONLINE', 'ARCADE') NOT NULL,
	PRIMARY KEY (video_game_pk)
);

CREATE TABLE products AS
SELECT m.movie_pk AS product_pk, m.title AS title, m.price AS price, m.media_type AS media_type, m.genre AS genre
FROM movies m
UNION ALL
SELECT vg.video_game_pk AS product_pk, vg.title AS title, vg.price AS price, vg.console AS media_type, vg.gameplay AS genre
FROM video_games vg;

ALTER TABLE products
ADD PRIMARY KEY AUTO_INCREMENT (product_pk);

ALTER TABLE products
ADD due_dat date;

ALTER TABLE products
ADD status varchar(25);


CREATE TABLE transactions (
	transaction_pk int unsigned NOT NULL AUTO_INCREMENT, 
	transaction_date date NOT null,
	due_date date NOT NULL,
	price float(5, 2) NOT NULL,
	product_list set('') NOT NULL,
	customer_fk int unsigned NOT NULL,
	administrator_fk int unsigned NOT NULL,
	PRIMARY KEY (transaction_pk),
	FOREIGN KEY (customer_fk) 
		REFERENCES customers (customer_pk),
	FOREIGN KEY (administrator_fk) 
		REFERENCES administration (administrator_pk)
);


CREATE TABLE reviews (
	review_pk int unsigned NOT NULL AUTO_INCREMENT, 
	review_string varchar(250) NOT NULL,
	movie_fk int unsigned,
	video_game_fk int unsigned,
	customer_fk int unsigned NOT NULL,
	PRIMARY KEY (review_pk),
	FOREIGN KEY (movie_fk) 
		REFERENCES movies (movie_pk) ON DELETE CASCADE,
	FOREIGN KEY (video_game_fk) 
		REFERENCES video_games (video_game_pk) ON DELETE CASCADE,
	FOREIGN KEY (customer_fk) 
		REFERENCES customers (customer_pk)
);
